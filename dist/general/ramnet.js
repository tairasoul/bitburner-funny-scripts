import { list_servers, gainAccess } from "./utils";
export default class RamNet {
    #blocks = [];
    #minBlockSize = Infinity;
    #maxBlockSize = 0;
    #totalRam = 0;
    #maxRam = 0;
    #index = new Map();
    #ns;
    constructor(ns) {
        this.#ns = ns;
    }
    async init() {
        for (const server of list_servers(this.#ns)) {
            if (!this.#ns.hasRootAccess(server)) {
                await gainAccess(this.#ns, server);
            }
            if (this.#ns.hasRootAccess(server)) {
                const maxRam = this.#ns.getServerMaxRam(server);
                const ram = maxRam - this.#ns.getServerUsedRam(server);
                if (ram >= 1.60) {
                    const block = { server: server, ram: ram };
                    this.#blocks.push(block);
                    if (ram < this.#minBlockSize)
                        this.#minBlockSize = ram;
                    if (ram > this.#maxBlockSize)
                        this.#maxBlockSize = ram;
                    this.#totalRam += ram;
                    this.#maxRam += maxRam;
                }
            }
        }
        this.#sort();
        this.#blocks.forEach((block, index) => this.#index.set(block.server, index));
    }
    async update() {
        this.#blocks = [];
        this.#totalRam += 0;
        this.#maxRam += 0;
        for (const server of list_servers(this.#ns)) {
            if (!this.#ns.hasRootAccess(server)) {
                await gainAccess(this.#ns, server);
            }
            if (this.#ns.hasRootAccess(server)) {
                const maxRam = this.#ns.getServerMaxRam(server);
                const ram = maxRam - this.#ns.getServerUsedRam(server);
                if (ram >= 1.60) {
                    const block = { server: server, ram: ram };
                    this.#blocks.push(block);
                    if (ram < this.#minBlockSize)
                        this.#minBlockSize = ram;
                    if (ram > this.#maxBlockSize)
                        this.#maxBlockSize = ram;
                    this.#totalRam += ram;
                    this.#maxRam += maxRam;
                }
            }
        }
        this.#sort();
        this.#blocks.forEach((block, index) => this.#index.set(block.server, index));
    }
    #sort() {
        this.#blocks.sort((x, y) => {
            // Prefer assigning to home last so that we have more room to play the game while batching.
            if (x.server === "home")
                return 1;
            if (y.server === "home")
                return -1;
            return x.ram - y.ram;
        });
    }
    getBlock(server) {
        if (this.#index.has(server)) {
            return this.#blocks[this.#index.get(server)];
        }
        else {
            throw new Error(`Server ${server} not found in RamNet.`);
        }
    }
    hasBlock(server) {
        return this.#index.has(server);
    }
    get totalRam() {
        return this.#totalRam;
    }
    get maxRam() {
        return this.#maxRam;
    }
    get maxBlockSize() {
        return this.#maxBlockSize;
    }
    get clone() {
        return this.#blocks.map(block => ({ ...block }));
    }
    assign(job) {
        const block = this.#blocks.find(block => block.ram >= job.ram);
        if (!block)
            return false;
        job.server = block.server;
        block.ram -= job.ram;
        this.#totalRam -= job.ram;
        return true;
    }
    finish(job) {
        const block = this.getBlock(job.server);
        block.ram += job.ram;
        this.#totalRam += job.ram;
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicmFtbmV0LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vc3JjL2dlbmVyYWwvcmFtbmV0LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUNBLE9BQU8sRUFBRSxZQUFZLEVBQUUsVUFBVSxFQUFFLE1BQU0sU0FBUyxDQUFDO0FBWW5ELE1BQU0sQ0FBQyxPQUFPLE9BQU8sTUFBTTtJQUN2QixPQUFPLEdBQVksRUFBRSxDQUFDO0lBQ3RCLGFBQWEsR0FBRyxRQUFRLENBQUM7SUFDekIsYUFBYSxHQUFHLENBQUMsQ0FBQztJQUNsQixTQUFTLEdBQUcsQ0FBQyxDQUFDO0lBQ2QsT0FBTyxHQUFHLENBQUMsQ0FBQztJQUNaLE1BQU0sR0FBd0IsSUFBSSxHQUFHLEVBQUUsQ0FBQztJQUN4QyxHQUFHLENBQU87SUFFVixZQUFZLEVBQVM7UUFDakIsSUFBSSxDQUFDLEdBQUcsR0FBRyxFQUFFLENBQUM7SUFDbEIsQ0FBQztJQUVELEtBQUssQ0FBQyxJQUFJO1FBQ04sS0FBSyxNQUFNLE1BQU0sSUFBSSxZQUFZLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFO1lBQ3pDLElBQUksQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLGFBQWEsQ0FBQyxNQUFNLENBQUMsRUFBRTtnQkFDakMsTUFBTSxVQUFVLENBQUMsSUFBSSxDQUFDLEdBQUcsRUFBRSxNQUFNLENBQUMsQ0FBQzthQUN0QztZQUNELElBQUksSUFBSSxDQUFDLEdBQUcsQ0FBQyxhQUFhLENBQUMsTUFBTSxDQUFDLEVBQUU7Z0JBQzVDLE1BQU0sTUFBTSxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUMsZUFBZSxDQUFDLE1BQU0sQ0FBQyxDQUFDO2dCQUNoRCxNQUFNLEdBQUcsR0FBRyxNQUFNLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxnQkFBZ0IsQ0FBQyxNQUFNLENBQUMsQ0FBQztnQkFDdkQsSUFBSSxHQUFHLElBQUksSUFBSSxFQUFFO29CQUNoQixNQUFNLEtBQUssR0FBRyxFQUFFLE1BQU0sRUFBRSxNQUFNLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxDQUFDO29CQUMzQyxJQUFJLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQztvQkFDekIsSUFBSSxHQUFHLEdBQUcsSUFBSSxDQUFDLGFBQWE7d0JBQUUsSUFBSSxDQUFDLGFBQWEsR0FBRyxHQUFHLENBQUM7b0JBQ3ZELElBQUksR0FBRyxHQUFHLElBQUksQ0FBQyxhQUFhO3dCQUFFLElBQUksQ0FBQyxhQUFhLEdBQUcsR0FBRyxDQUFDO29CQUN2RCxJQUFJLENBQUMsU0FBUyxJQUFJLEdBQUcsQ0FBQztvQkFDdEIsSUFBSSxDQUFDLE9BQU8sSUFBSSxNQUFNLENBQUM7aUJBQ3ZCO2FBQ1E7U0FDSjtRQUNQLElBQUksQ0FBQyxLQUFLLEVBQUUsQ0FBQztRQUViLElBQUksQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLENBQUMsS0FBSyxFQUFFLEtBQUssRUFBRSxFQUFFLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsS0FBSyxDQUFDLE1BQU0sRUFBRSxLQUFLLENBQUMsQ0FBQyxDQUFDO0lBQzNFLENBQUM7SUFFRCxLQUFLLENBQUMsTUFBTTtRQUNSLElBQUksQ0FBQyxPQUFPLEdBQUcsRUFBRSxDQUFDO1FBQ2xCLElBQUksQ0FBQyxTQUFTLElBQUksQ0FBQyxDQUFDO1FBQ3BCLElBQUksQ0FBQyxPQUFPLElBQUksQ0FBQyxDQUFDO1FBQ2xCLEtBQUssTUFBTSxNQUFNLElBQUksWUFBWSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRTtZQUN6QyxJQUFJLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxhQUFhLENBQUMsTUFBTSxDQUFDLEVBQUU7Z0JBQ2pDLE1BQU0sVUFBVSxDQUFDLElBQUksQ0FBQyxHQUFHLEVBQUUsTUFBTSxDQUFDLENBQUM7YUFDdEM7WUFDRCxJQUFJLElBQUksQ0FBQyxHQUFHLENBQUMsYUFBYSxDQUFDLE1BQU0sQ0FBQyxFQUFFO2dCQUM1QyxNQUFNLE1BQU0sR0FBRyxJQUFJLENBQUMsR0FBRyxDQUFDLGVBQWUsQ0FBQyxNQUFNLENBQUMsQ0FBQztnQkFDaEQsTUFBTSxHQUFHLEdBQUcsTUFBTSxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUMsZ0JBQWdCLENBQUMsTUFBTSxDQUFDLENBQUM7Z0JBQ3ZELElBQUksR0FBRyxJQUFJLElBQUksRUFBRTtvQkFDaEIsTUFBTSxLQUFLLEdBQUcsRUFBRSxNQUFNLEVBQUUsTUFBTSxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsQ0FBQztvQkFDM0MsSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7b0JBQ3pCLElBQUksR0FBRyxHQUFHLElBQUksQ0FBQyxhQUFhO3dCQUFFLElBQUksQ0FBQyxhQUFhLEdBQUcsR0FBRyxDQUFDO29CQUN2RCxJQUFJLEdBQUcsR0FBRyxJQUFJLENBQUMsYUFBYTt3QkFBRSxJQUFJLENBQUMsYUFBYSxHQUFHLEdBQUcsQ0FBQztvQkFDdkQsSUFBSSxDQUFDLFNBQVMsSUFBSSxHQUFHLENBQUM7b0JBQ3RCLElBQUksQ0FBQyxPQUFPLElBQUksTUFBTSxDQUFDO2lCQUN2QjthQUNRO1NBQ0o7UUFDUCxJQUFJLENBQUMsS0FBSyxFQUFFLENBQUM7UUFFYixJQUFJLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyxDQUFDLEtBQUssRUFBRSxLQUFLLEVBQUUsRUFBRSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyxNQUFNLEVBQUUsS0FBSyxDQUFDLENBQUMsQ0FBQztJQUMzRSxDQUFDO0lBRUosS0FBSztRQUNKLElBQUksQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxFQUFFO1lBQzFCLDJGQUEyRjtZQUMzRixJQUFJLENBQUMsQ0FBQyxNQUFNLEtBQUssTUFBTTtnQkFBRSxPQUFPLENBQUMsQ0FBQztZQUNsQyxJQUFJLENBQUMsQ0FBQyxNQUFNLEtBQUssTUFBTTtnQkFBRSxPQUFPLENBQUMsQ0FBQyxDQUFDO1lBRW5DLE9BQU8sQ0FBQyxDQUFDLEdBQUcsR0FBRyxDQUFDLENBQUMsR0FBRyxDQUFDO1FBQ3RCLENBQUMsQ0FBQyxDQUFDO0lBQ0osQ0FBQztJQUVELFFBQVEsQ0FBQyxNQUFjO1FBQ3RCLElBQUksSUFBSSxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsTUFBTSxDQUFDLEVBQUU7WUFDNUIsT0FBTyxJQUFJLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLE1BQU0sQ0FBVyxDQUFDLENBQUM7U0FDdkQ7YUFBTTtZQUNOLE1BQU0sSUFBSSxLQUFLLENBQUMsVUFBVSxNQUFNLHVCQUF1QixDQUFDLENBQUM7U0FDekQ7SUFDRixDQUFDO0lBRUUsUUFBUSxDQUFDLE1BQWM7UUFDbkIsT0FBTyxJQUFJLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxNQUFNLENBQUMsQ0FBQztJQUNuQyxDQUFDO0lBQ0osSUFBSSxRQUFRO1FBQ1gsT0FBTyxJQUFJLENBQUMsU0FBUyxDQUFDO0lBQ3ZCLENBQUM7SUFFRCxJQUFJLE1BQU07UUFDVCxPQUFPLElBQUksQ0FBQyxPQUFPLENBQUM7SUFDckIsQ0FBQztJQUVELElBQUksWUFBWTtRQUNmLE9BQU8sSUFBSSxDQUFDLGFBQWEsQ0FBQztJQUMzQixDQUFDO0lBRUQsSUFBSSxLQUFLO1FBQ1IsT0FBTyxJQUFJLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxLQUFLLENBQUMsRUFBRSxDQUFDLENBQUMsRUFBRSxHQUFHLEtBQUssRUFBRSxDQUFDLENBQUMsQ0FBQztJQUNsRCxDQUFDO0lBRUUsTUFBTSxDQUFDLEdBQVE7UUFDWCxNQUFNLEtBQUssR0FBRyxJQUFJLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsRUFBRSxDQUFDLEtBQUssQ0FBQyxHQUFHLElBQUksR0FBRyxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBQy9ELElBQUksQ0FBQyxLQUFLO1lBQUUsT0FBTyxLQUFLLENBQUM7UUFDekIsR0FBRyxDQUFDLE1BQU0sR0FBRyxLQUFLLENBQUMsTUFBTSxDQUFDO1FBQzFCLEtBQUssQ0FBQyxHQUFHLElBQUksR0FBRyxDQUFDLEdBQUcsQ0FBQztRQUNyQixJQUFJLENBQUMsU0FBUyxJQUFJLEdBQUcsQ0FBQyxHQUFHLENBQUM7UUFDMUIsT0FBTyxJQUFJLENBQUM7SUFDaEIsQ0FBQztJQUVELE1BQU0sQ0FBQyxHQUFRO1FBQ1gsTUFBTSxLQUFLLEdBQUcsSUFBSSxDQUFDLFFBQVEsQ0FBQyxHQUFHLENBQUMsTUFBTSxDQUFDLENBQUM7UUFDeEMsS0FBSyxDQUFDLEdBQUcsSUFBSSxHQUFHLENBQUMsR0FBRyxDQUFDO1FBQ3JCLElBQUksQ0FBQyxTQUFTLElBQUksR0FBRyxDQUFDLEdBQUcsQ0FBQztJQUM5QixDQUFDO0NBQ0oiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgbnMgZnJvbSBcIkBuc1wiO1xuaW1wb3J0IHsgbGlzdF9zZXJ2ZXJzLCBnYWluQWNjZXNzIH0gZnJvbSBcIi4vdXRpbHNcIjtcblxudHlwZSBCbG9jayA9IHtcbiAgICBzZXJ2ZXI6IHN0cmluZztcbiAgICByYW06IG51bWJlcjtcbn1cblxuZXhwb3J0IHR5cGUgSm9iID0ge1xuICAgIHNlcnZlcjogc3RyaW5nO1xuICAgIHJhbTogbnVtYmVyO1xufVxuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBSYW1OZXQge1xuICAgICNibG9ja3M6IEJsb2NrW10gPSBbXTtcbiAgICAjbWluQmxvY2tTaXplID0gSW5maW5pdHk7XG4gICAgI21heEJsb2NrU2l6ZSA9IDA7XG4gICAgI3RvdGFsUmFtID0gMDtcbiAgICAjbWF4UmFtID0gMDtcbiAgICAjaW5kZXg6IE1hcDxzdHJpbmcsIG51bWJlcj4gPSBuZXcgTWFwKCk7XG4gICAgI25zOiBucy5OU1xuICAgIFxuICAgIGNvbnN0cnVjdG9yKG5zOiBucy5OUykge1xuICAgICAgICB0aGlzLiNucyA9IG5zO1xuICAgIH1cblxuICAgIGFzeW5jIGluaXQoKSB7XG4gICAgICAgIGZvciAoY29uc3Qgc2VydmVyIG9mIGxpc3Rfc2VydmVycyh0aGlzLiNucykpIHtcbiAgICAgICAgICAgIGlmICghdGhpcy4jbnMuaGFzUm9vdEFjY2VzcyhzZXJ2ZXIpKSB7XG4gICAgICAgICAgICAgICAgYXdhaXQgZ2FpbkFjY2Vzcyh0aGlzLiNucywgc2VydmVyKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICh0aGlzLiNucy5oYXNSb290QWNjZXNzKHNlcnZlcikpIHtcblx0XHRcdFx0Y29uc3QgbWF4UmFtID0gdGhpcy4jbnMuZ2V0U2VydmVyTWF4UmFtKHNlcnZlcik7XG5cdFx0XHRcdGNvbnN0IHJhbSA9IG1heFJhbSAtIHRoaXMuI25zLmdldFNlcnZlclVzZWRSYW0oc2VydmVyKTtcblx0XHRcdFx0aWYgKHJhbSA+PSAxLjYwKSB7XG5cdFx0XHRcdFx0Y29uc3QgYmxvY2sgPSB7IHNlcnZlcjogc2VydmVyLCByYW06IHJhbSB9O1xuXHRcdFx0XHRcdHRoaXMuI2Jsb2Nrcy5wdXNoKGJsb2NrKTtcblx0XHRcdFx0XHRpZiAocmFtIDwgdGhpcy4jbWluQmxvY2tTaXplKSB0aGlzLiNtaW5CbG9ja1NpemUgPSByYW07XG5cdFx0XHRcdFx0aWYgKHJhbSA+IHRoaXMuI21heEJsb2NrU2l6ZSkgdGhpcy4jbWF4QmxvY2tTaXplID0gcmFtO1xuXHRcdFx0XHRcdHRoaXMuI3RvdGFsUmFtICs9IHJhbTtcblx0XHRcdFx0XHR0aGlzLiNtYXhSYW0gKz0gbWF4UmFtO1xuXHRcdFx0XHR9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblx0XHR0aGlzLiNzb3J0KCk7XG5cblx0XHR0aGlzLiNibG9ja3MuZm9yRWFjaCgoYmxvY2ssIGluZGV4KSA9PiB0aGlzLiNpbmRleC5zZXQoYmxvY2suc2VydmVyLCBpbmRleCkpO1xuICAgIH1cblxuICAgIGFzeW5jIHVwZGF0ZSgpIHtcbiAgICAgICAgdGhpcy4jYmxvY2tzID0gW107XG4gICAgICAgIHRoaXMuI3RvdGFsUmFtICs9IDA7XG4gICAgICAgIHRoaXMuI21heFJhbSArPSAwO1xuICAgICAgICBmb3IgKGNvbnN0IHNlcnZlciBvZiBsaXN0X3NlcnZlcnModGhpcy4jbnMpKSB7XG4gICAgICAgICAgICBpZiAoIXRoaXMuI25zLmhhc1Jvb3RBY2Nlc3Moc2VydmVyKSkge1xuICAgICAgICAgICAgICAgIGF3YWl0IGdhaW5BY2Nlc3ModGhpcy4jbnMsIHNlcnZlcik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAodGhpcy4jbnMuaGFzUm9vdEFjY2VzcyhzZXJ2ZXIpKSB7XG5cdFx0XHRcdGNvbnN0IG1heFJhbSA9IHRoaXMuI25zLmdldFNlcnZlck1heFJhbShzZXJ2ZXIpO1xuXHRcdFx0XHRjb25zdCByYW0gPSBtYXhSYW0gLSB0aGlzLiNucy5nZXRTZXJ2ZXJVc2VkUmFtKHNlcnZlcik7XG5cdFx0XHRcdGlmIChyYW0gPj0gMS42MCkge1xuXHRcdFx0XHRcdGNvbnN0IGJsb2NrID0geyBzZXJ2ZXI6IHNlcnZlciwgcmFtOiByYW0gfTtcblx0XHRcdFx0XHR0aGlzLiNibG9ja3MucHVzaChibG9jayk7XG5cdFx0XHRcdFx0aWYgKHJhbSA8IHRoaXMuI21pbkJsb2NrU2l6ZSkgdGhpcy4jbWluQmxvY2tTaXplID0gcmFtO1xuXHRcdFx0XHRcdGlmIChyYW0gPiB0aGlzLiNtYXhCbG9ja1NpemUpIHRoaXMuI21heEJsb2NrU2l6ZSA9IHJhbTtcblx0XHRcdFx0XHR0aGlzLiN0b3RhbFJhbSArPSByYW07XG5cdFx0XHRcdFx0dGhpcy4jbWF4UmFtICs9IG1heFJhbTtcblx0XHRcdFx0fVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cdFx0dGhpcy4jc29ydCgpO1xuXG5cdFx0dGhpcy4jYmxvY2tzLmZvckVhY2goKGJsb2NrLCBpbmRleCkgPT4gdGhpcy4jaW5kZXguc2V0KGJsb2NrLnNlcnZlciwgaW5kZXgpKTtcbiAgICB9XG4gICAgXG5cdCNzb3J0KCkge1xuXHRcdHRoaXMuI2Jsb2Nrcy5zb3J0KCh4LCB5KSA9PiB7XG5cdFx0XHQvLyBQcmVmZXIgYXNzaWduaW5nIHRvIGhvbWUgbGFzdCBzbyB0aGF0IHdlIGhhdmUgbW9yZSByb29tIHRvIHBsYXkgdGhlIGdhbWUgd2hpbGUgYmF0Y2hpbmcuXG5cdFx0XHRpZiAoeC5zZXJ2ZXIgPT09IFwiaG9tZVwiKSByZXR1cm4gMTtcblx0XHRcdGlmICh5LnNlcnZlciA9PT0gXCJob21lXCIpIHJldHVybiAtMTtcblxuXHRcdFx0cmV0dXJuIHgucmFtIC0geS5yYW07XG5cdFx0fSk7XG5cdH1cblxuXHRnZXRCbG9jayhzZXJ2ZXI6IHN0cmluZykge1xuXHRcdGlmICh0aGlzLiNpbmRleC5oYXMoc2VydmVyKSkge1xuXHRcdFx0cmV0dXJuIHRoaXMuI2Jsb2Nrc1t0aGlzLiNpbmRleC5nZXQoc2VydmVyKSBhcyBudW1iZXJdO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHR0aHJvdyBuZXcgRXJyb3IoYFNlcnZlciAke3NlcnZlcn0gbm90IGZvdW5kIGluIFJhbU5ldC5gKTtcblx0XHR9XG5cdH1cblxuICAgIGhhc0Jsb2NrKHNlcnZlcjogc3RyaW5nKSB7XG4gICAgICAgIHJldHVybiB0aGlzLiNpbmRleC5oYXMoc2VydmVyKTtcbiAgICB9XG5cdGdldCB0b3RhbFJhbSgpIHtcblx0XHRyZXR1cm4gdGhpcy4jdG90YWxSYW07XG5cdH1cblxuXHRnZXQgbWF4UmFtKCkge1xuXHRcdHJldHVybiB0aGlzLiNtYXhSYW07XG5cdH1cblxuXHRnZXQgbWF4QmxvY2tTaXplKCkge1xuXHRcdHJldHVybiB0aGlzLiNtYXhCbG9ja1NpemU7XG5cdH1cblxuXHRnZXQgY2xvbmUoKSB7XG5cdFx0cmV0dXJuIHRoaXMuI2Jsb2Nrcy5tYXAoYmxvY2sgPT4gKHsgLi4uYmxvY2sgfSkpO1xuXHR9XG5cbiAgICBhc3NpZ24oam9iOiBKb2IpIHtcbiAgICAgICAgY29uc3QgYmxvY2sgPSB0aGlzLiNibG9ja3MuZmluZChibG9jayA9PiBibG9jay5yYW0gPj0gam9iLnJhbSk7XG4gICAgICAgIGlmICghYmxvY2spIHJldHVybiBmYWxzZTtcbiAgICAgICAgam9iLnNlcnZlciA9IGJsb2NrLnNlcnZlcjtcbiAgICAgICAgYmxvY2sucmFtIC09IGpvYi5yYW07XG4gICAgICAgIHRoaXMuI3RvdGFsUmFtIC09IGpvYi5yYW07XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cblxuICAgIGZpbmlzaChqb2I6IEpvYikge1xuICAgICAgICBjb25zdCBibG9jayA9IHRoaXMuZ2V0QmxvY2soam9iLnNlcnZlcik7XG4gICAgICAgIGJsb2NrLnJhbSArPSBqb2IucmFtO1xuICAgICAgICB0aGlzLiN0b3RhbFJhbSArPSBqb2IucmFtO1xuICAgIH1cbn0iXX0=