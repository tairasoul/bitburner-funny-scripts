import { getReactKey } from "/react-handlers/get_react_key";
var sizes;
(function (sizes) {
    sizes[sizes["Smallest"] = 9] = "Smallest";
    sizes[sizes["Small"] = 16] = "Small";
    sizes[sizes["Medium"] = 25] = "Medium";
    sizes[sizes["Large"] = 36] = "Large";
})(sizes || (sizes = {}));
function turnIntoGrid(items) {
    const size = getSize(items);
    console.log(size);
    if (size != undefined) {
        return createGrid(items, size);
    }
    throw new Error(`Could not turn array of length ${items.length} into grid.`);
}
function createGrid(items, size) {
    const grid = [];
    const limit = size == sizes.Smallest ? 3 : size == sizes.Small ? 4 : size == sizes.Medium ? 5 : 6;
    console.log(limit);
    let index = 0;
    for (let i = 0; i < limit; i++) {
        grid.push([]);
        for (let j = 0; j < limit; j++) {
            grid[i].push(items[index]);
            index++;
        }
    }
    return grid;
}
function generateInstructions(currentPosition, targetPosition) {
    const instructions = [];
    let [currentRow, currentColumn] = currentPosition;
    const [targetRow, targetColumn] = targetPosition;
    while (currentRow !== targetRow || currentColumn !== targetColumn) {
        if (currentRow < targetRow) {
            instructions.push("ArrowDown");
            currentRow++;
        }
        else if (currentRow > targetRow) {
            instructions.push("ArrowUp");
            currentRow--;
        }
        if (currentColumn < targetColumn) {
            instructions.push("ArrowRight");
            currentColumn++;
        }
        else if (currentColumn > targetColumn) {
            instructions.push("ArrowLeft");
            currentColumn--;
        }
    }
    instructions.push(" ");
    return instructions;
}
function getSize(items) {
    if (items.length == 6 * 6)
        return sizes.Large;
    if (items.length == 5 * 5)
        return sizes.Medium;
    if (items.length == 4 * 4)
        return sizes.Small;
    if (items.length == 3 * 3)
        return sizes.Smallest;
    return;
}
function findPositions(grid, criteria) {
    const positions = [];
    for (let i = 0; i < grid.length; i++) {
        for (let j = 0; j < grid[i].length; j++) {
            if (criteria(grid[i][j])) {
                positions.push([i, j]);
            }
        }
    }
    return positions;
}
export async function SolveMinefield(ns) {
    const doc = eval("document");
    const answerElement = doc.querySelector("#root > div.MuiBox-root > div > div > div:nth-child(3)");
    const minefield = answerElement.querySelector("div");
    const mines = minefield.querySelectorAll("p");
    const grid = turnIntoGrid(Array.from(mines));
    console.log(grid);
    const positions = findPositions(grid, (elem) => elem.querySelector("svg") != null);
    const reactKey = getReactKey(answerElement, "Props$");
    // @ts-ignore
    const keyDown = answerElement[reactKey].children[2].props.onKeyDown;
    while (true) {
        await ns.sleep(1);
        if (answerElement.querySelector('h4').textContent?.trim() == "Mark all the mines!")
            break;
    }
    await ns.sleep(50);
    let current = [0, 0];
    for (const position of positions) {
        await ns.sleep(50);
        const instructions = generateInstructions(current, position);
        console.log(current, position, instructions);
        current = position;
        for (const instruction of instructions) {
            await ns.sleep(50);
            const event = {
                preventDefault: () => { },
                key: instruction,
                isTrusted: true,
                target: answerElement,
                currentTarget: answerElement,
                bubbles: true,
                cancelable: true
            };
            keyDown(event);
        }
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWluZWZpZWxkLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vc3JjL2luZmlsLWNoZWF0aW5nL2hhbmRsZXJzL21pbmVmaWVsZC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFDQSxPQUFPLEVBQUUsV0FBVyxFQUFFLE1BQU0sK0JBQStCLENBQUM7QUFFNUQsSUFBSyxLQUtKO0FBTEQsV0FBSyxLQUFLO0lBQ04seUNBQWMsQ0FBQTtJQUNkLG9DQUFXLENBQUE7SUFDWCxzQ0FBWSxDQUFBO0lBQ1osb0NBQVcsQ0FBQTtBQUNmLENBQUMsRUFMSSxLQUFLLEtBQUwsS0FBSyxRQUtUO0FBRUQsU0FBUyxZQUFZLENBQUksS0FBVTtJQUMvQixNQUFNLElBQUksR0FBRyxPQUFPLENBQUMsS0FBSyxDQUFDLENBQUM7SUFDNUIsT0FBTyxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQztJQUNsQixJQUFJLElBQUksSUFBSSxTQUFTLEVBQUU7UUFDbkIsT0FBTyxVQUFVLENBQUMsS0FBSyxFQUFFLElBQUksQ0FBQyxDQUFBO0tBQ2pDO0lBQ0QsTUFBTSxJQUFJLEtBQUssQ0FBQyxrQ0FBa0MsS0FBSyxDQUFDLE1BQU0sYUFBYSxDQUFDLENBQUM7QUFDakYsQ0FBQztBQUVELFNBQVMsVUFBVSxDQUFJLEtBQVUsRUFBRSxJQUFXO0lBQzFDLE1BQU0sSUFBSSxHQUFVLEVBQUUsQ0FBQztJQUN2QixNQUFNLEtBQUssR0FBRyxJQUFJLElBQUksS0FBSyxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLElBQUksS0FBSyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLElBQUksS0FBSyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUE7SUFDakcsT0FBTyxDQUFDLEdBQUcsQ0FBQyxLQUFLLENBQUMsQ0FBQztJQUNu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QyxDQUFDLENBQUM7SUFDdkMsS0FBSyxNQUFNLFFBQVEsSUFBSSxTQUFTLEVBQUU7UUFDOUIsTUFBTSxFQUFFLENBQUMsS0FBSyxDQUFDLEVBQUUsQ0FBQyxDQUFDO1FBQ25CLE1BQU0sWUFBWSxHQUFHLG9CQUFvQixDQUFDLE9BQU8sRUFBRSxRQUFRLENBQUMsQ0FBQztRQUM3RCxPQUFPLENBQUMsR0FBRyxDQUFDLE9BQU8sRUFBRSxRQUFRLEVBQUUsWUFBWSxDQUFDLENBQUE7UUFDNUMsT0FBTyxHQUFHLFFBQVEsQ0FBQztRQUNuQixLQUFLLE1BQU0sV0FBVyxJQUFJLFlBQVksRUFBRTtZQUNwQyxNQUFNLEVBQUUsQ0FBQyxLQUFLLENBQUMsRUFBRSxDQUFDLENBQUM7WUFDbkIsTUFBTSxLQUFLLEdBQUc7Z0JBQ1YsY0FBYyxFQUFFLEdBQUcsRUFBRSxHQUFFLENBQUM7Z0JBQ3hCLEdBQUcsRUFBRSxXQUFXO2dCQUNoQixTQUFTLEVBQUUsSUFBSTtnQkFDZixNQUFNLEVBQUUsYUFBYTtnQkFDckIsYUFBYSxFQUFFLGFBQWE7Z0JBQzVCLE9BQU8sRUFBRSxJQUFJO2dCQUNiLFVBQVUsRUFBRSxJQUFJO2FBQ25CLENBQUE7WUFDRCxPQUFPLENBQUMsS0FBSyxDQUFDLENBQUM7U0FDbEI7S0FDSjtBQUNMLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBOUyB9IGZyb20gXCJAbnNcIjtcbmltcG9ydCB7IGdldFJlYWN0S2V5IH0gZnJvbSBcIi9yZWFjdC1oYW5kbGVycy9nZXRfcmVhY3Rfa2V5XCI7XG5cbmVudW0gc2l6ZXMge1xuICAgIFNtYWxsZXN0ID0gMyozLFxuICAgIFNtYWxsID0gNCo0LFxuICAgIE1lZGl1bSA9IDUqNSxcbiAgICBMYXJnZSA9IDYqNlxufVxuXG5mdW5jdGlvbiB0dXJuSW50b0dyaWQ8VD4oaXRlbXM6IFRbXSkge1xuICAgIGNvbnN0IHNpemUgPSBnZXRTaXplKGl0ZW1zKTtcbiAgICBjb25zb2xlLmxvZyhzaXplKTtcbiAgICBpZiAoc2l6ZSAhPSB1bmRlZmluZWQpIHtcbiAgICAgICAgcmV0dXJuIGNyZWF0ZUdyaWQoaXRlbXMsIHNpemUpXG4gICAgfVxuICAgIHRocm93IG5ldyBFcnJvcihgQ291bGQgbm90IHR1cm4gYXJyYXkgb2YgbGVuZ3RoICR7aXRlbXMubGVuZ3RofSBpbnRvIGdyaWQuYCk7XG59XG5cbmZ1bmN0aW9uIGNyZWF0ZUdyaWQ8VD4oaXRlbXM6IFRbXSwgc2l6ZTogc2l6ZXMpOiBUW11bXSB7XG4gICAgY29uc3QgZ3JpZDogVFtdW10gPSBbXTtcbiAgICBjb25zdCBsaW1pdCA9IHNpemUgPT0gc2l6ZXMuU21hbGxlc3QgPyAzIDogc2l6ZSA9PSBzaXplcy5TbWFsbCA/IDQgOiBzaXplID09IHNpemVzLk1lZGl1bSA/IDUgOiA2XG4gICAgY29uc29sZS5sb2cobGltaXQpO1xuICAgIGxldCBpbmRleCA9IDA7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBsaW1pdDsgaSsrKSB7XG4gICAgICAgIGdyaWQucHVzaChbXSk7XG4gICAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgbGltaXQ7IGorKykge1xuICAgICAgICAgICAgZ3JpZFtpXS5wdXNoKGl0ZW1zW2luZGV4XSk7XG4gICAgICAgICAgICBpbmRleCsrO1xuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiBncmlkO1xufVxuXG5mdW5jdGlvbiBnZW5lcmF0ZUluc3RydWN0aW9ucyhjdXJyZW50UG9zaXRpb246IFtudW1iZXIsIG51bWJlcl0sIHRhcmdldFBvc2l0aW9uOiBbbnVtYmVyLCBudW1iZXJdKTogc3RyaW5nW10ge1xuICAgIGNvbnN0IGluc3RydWN0aW9uczogc3RyaW5nW10gPSBbXTtcbiAgICBsZXQgW2N1cnJlbnRSb3csIGN1cnJlbnRDb2x1bW5dID0gY3VycmVudFBvc2l0aW9uO1xuICAgIGNvbnN0IFt0YXJnZXRSb3csIHRhcmdldENvbHVtbl0gPSB0YXJnZXRQb3NpdGlvbjtcblxuICAgIHdoaWxlIChjdXJyZW50Um93ICE9PSB0YXJnZXRSb3cgfHwgY3VycmVudENvbHVtbiAhPT0gdGFyZ2V0Q29sdW1uKSB7XG4gICAgICAgIGlmIChjdXJyZW50Um93IDwgdGFyZ2V0Um93KSB7XG4gICAgICAgICAgICBpbnN0cnVjdGlvbnMucHVzaChcIkFycm93RG93blwiKTtcbiAgICAgICAgICAgIGN1cnJlbnRSb3crKztcbiAgICAgICAgfSBlbHNlIGlmIChjdXJyZW50Um93ID4gdGFyZ2V0Um93KSB7XG4gICAgICAgICAgICBpbnN0cnVjdGlvbnMucHVzaChcIkFycm93VXBcIik7XG4gICAgICAgICAgICBjdXJyZW50Um93LS07XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoY3VycmVudENvbHVtbiA8IHRhcmdldENvbHVtbikge1xuICAgICAgICAgICAgaW5zdHJ1Y3Rpb25zLnB1c2goXCJBcnJvd1JpZ2h0XCIpO1xuICAgICAgICAgICAgY3VycmVudENvbHVtbisrO1xuICAgICAgICB9IGVsc2UgaWYgKGN1cnJlbnRDb2x1bW4gPiB0YXJnZXRDb2x1bW4pIHtcbiAgICAgICAgICAgIGluc3RydWN0aW9ucy5wdXNoKFwiQXJyb3dMZWZ0XCIpO1xuICAgICAgICAgICAgY3VycmVudENvbHVtbi0tO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgaW5zdHJ1Y3Rpb25zLnB1c2goXCIgXCIpO1xuXG4gICAgcmV0dXJuIGluc3RydWN0aW9ucztcbn1cblxuZnVuY3Rpb24gZ2V0U2l6ZShpdGVtczogYW55W10pIHtcbiAgICBpZiAoaXRlbXMubGVuZ3RoID09IDYqNilcbiAgICAgICAgcmV0dXJuIHNpemVzLkxhcmdlO1xuICAgIGlmIChpdGVtcy5sZW5ndGggPT0gNSo1KVxuICAgICAgICByZXR1cm4gc2l6ZXMuTWVkaXVtO1xuICAgIGlmIChpdGVtcy5sZW5ndGggPT0gNCo0KVxuICAgICAgICByZXR1cm4gc2l6ZXMuU21hbGw7XG4gICAgaWYgKGl0ZW1zLmxlbmd0aCA9PSAzKjMpXG4gICAgICAgIHJldHVybiBzaXplcy5TbWFsbGVzdDtcbiAgICByZXR1cm47XG59XG5cbmZ1bmN0aW9uIGZpbmRQb3NpdGlvbnM8VCBleHRlbmRzIEhUTUxFbGVtZW50PihncmlkOiBUW11bXSwgY3JpdGVyaWE6IChlbGVtZW50OiBUKSA9PiBib29sZWFuKTogW251bWJlciwgbnVtYmVyXVtdIHtcbiAgICBjb25zdCBwb3NpdGlvbnM6IFtudW1iZXIsIG51bWJlcl1bXSA9IFtdO1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZ3JpZC5sZW5ndGg7IGkrKykge1xuICAgICAgICBmb3IgKGxldCBqID0gMDsgaiA8IGdyaWRbaV0ubGVuZ3RoOyBqKyspIHtcbiAgICAgICAgICAgIGlmIChjcml0ZXJpYShncmlkW2ldW2pdKSkge1xuICAgICAgICAgICAgICAgIHBvc2l0aW9ucy5wdXNoKFtpLCBqXSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHBvc2l0aW9ucztcbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIFNvbHZlTWluZWZpZWxkKG5zOiBOUykge1xuICAgIGNvbnN0IGRvYyA9IGV2YWwoXCJkb2N1bWVudFwiKSBhcyBEb2N1bWVudDtcbiAgICBjb25zdCBhbnN3ZXJFbGVtZW50ID0gZG9jLnF1ZXJ5U2VsZWN0b3IoXCIjcm9vdCA+IGRpdi5NdWlCb3gtcm9vdCA+IGRpdiA+IGRpdiA+IGRpdjpudGgtY2hpbGQoMylcIikgYXMgSFRNTEVsZW1lbnQ7XG4gICAgY29uc3QgbWluZWZpZWxkID0gYW5zd2VyRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiZGl2XCIpIGFzIEhUTUxFbGVtZW50O1xuICAgIGNvbnN0IG1pbmVzID0gbWluZWZpZWxkLnF1ZXJ5U2VsZWN0b3JBbGwoXCJwXCIpO1xuICAgIGNvbnN0IGdyaWQgPSB0dXJuSW50b0dyaWQoQXJyYXkuZnJvbShtaW5lcykpO1xuICAgIGNvbnNvbGUubG9nKGdyaWQpO1xuICAgIGNvbnN0IHBvc2l0aW9ucyA9IGZpbmRQb3NpdGlvbnMoZ3JpZCwgKGVsZW0pID0+IGVsZW0ucXVlcnlTZWxlY3RvcihcInN2Z1wiKSAhPSBudWxsKTtcbiAgICBjb25zdCByZWFjdEtleSA9IGdldFJlYWN0S2V5KGFuc3dlckVsZW1lbnQsIFwiUHJvcHMkXCIpO1xuICAgIC8vIEB0cy1pZ25vcmVcbiAgICBjb25zdCBrZXlEb3duID0gYW5zd2VyRWxlbWVudFtyZWFjdEtleV0uY2hpbGRyZW5bMl0ucHJvcHMub25LZXlEb3duO1xuICAgIHdoaWxlICh0cnVlKSB7XG4gICAgICAgIGF3YWl0IG5zLnNsZWVwKDEpXG4gICAgICAgIGlmICgoYW5zd2VyRWxlbWVudC5xdWVyeVNlbGVjdG9yKCdoNCcpIGFzIEhUTUxFbGVtZW50KS50ZXh0Q29udGVudD8udHJpbSgpID09IFwiTWFyayBhbGwgdGhlIG1pbmVzIVwiKVxuICAgICAgICAgICAgYnJlYWs7XG4gICAgfVxuICAgIFxuICAgIGF3YWl0IG5zLnNsZWVwKDUwKTtcblxuICAgIGxldCBjdXJyZW50OiBbbnVtYmVyLCBudW1iZXJdID0gWzAsIDBdO1xuICAgIGZvciAoY29uc3QgcG9zaXRpb24gb2YgcG9zaXRpb25zKSB7XG4gICAgICAgIGF3YWl0IG5zLnNsZWVwKDUwKTtcbiAgICAgICAgY29uc3QgaW5zdHJ1Y3Rpb25zID0gZ2VuZXJhdGVJbnN0cnVjdGlvbnMoY3VycmVudCwgcG9zaXRpb24pO1xuICAgICAgICBjb25zb2xlLmxvZyhjdXJyZW50LCBwb3NpdGlvbiwgaW5zdHJ1Y3Rpb25zKVxuICAgICAgICBjdXJyZW50ID0gcG9zaXRpb247XG4gICAgICAgIGZvciAoY29uc3QgaW5zdHJ1Y3Rpb24gb2YgaW5zdHJ1Y3Rpb25zKSB7XG4gICAgICAgICAgICBhd2FpdCBucy5zbGVlcCg1MCk7XG4gICAgICAgICAgICBjb25zdCBldmVudCA9IHtcbiAgICAgICAgICAgICAgICBwcmV2ZW50RGVmYXVsdDogKCkgPT4ge30sXG4gICAgICAgICAgICAgICAga2V5OiBpbnN0cnVjdGlvbixcbiAgICAgICAgICAgICAgICBpc1RydXN0ZWQ6IHRydWUsXG4gICAgICAgICAgICAgICAgdGFyZ2V0OiBhbnN3ZXJFbGVtZW50LFxuICAgICAgICAgICAgICAgIGN1cnJlbnRUYXJnZXQ6IGFuc3dlckVsZW1lbnQsXG4gICAgICAgICAgICAgICAgYnViYmxlczogdHJ1ZSxcbiAgICAgICAgICAgICAgICBjYW5jZWxhYmxlOiB0cnVlXG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBrZXlEb3duKGV2ZW50KTtcbiAgICAgICAgfVxuICAgIH1cbn0iXX0=